<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>Admin panel</title>
  <style>
    body { font-family: sans-serif; background:#f5f5f5; padding:20px }
    .card { background:#fff; padding:16px; border-radius:8px; margin-bottom:16px }
    input, button { padding:6px 8px; margin:4px 0 }
    pre { background:#eee; padding:10px; overflow:auto }
  </style>
</head>
<body>

<h1>Admin panel</h1>

<div class="card">
  <b>API:</b> https://boxing-manager-admin-api.onrender.com
</div>

<div class="card">
  <div id="tgLogin"></div>
  <div id="loginStatus">Не залогінено</div>
</div>

<div class="card">
  <b>Admin:</b> <span id="adminId">—</span>
  <button onclick="logout()">Logout</button>
</div>

<div class="card">
  <h3>User</h3>
  <input id="userId" placeholder="telegram_user_id">
  <button onclick="loadUser()">Load</button>
  <pre id="userData">—</pre>
</div>

<div class="card">
  <h3>Actions</h3>
  <input id="starsAmount" placeholder="Stars">
  <button onclick="giveStars()">Give stars</button><br>
  <input id="cashAmount" placeholder="Cash">
  <button onclick="giveCash()">Give cash</button>
</div>

<div class="card">
  <h3>Debug</h3>
  <pre id="debug">—</pre>
</div>

<script>
const API = 'https://boxing-manager-admin-api.onrender.com';
let token = localStorage.getItem('admin_jwt') || null;

function setDebug(obj) {
  document.getElementById('debug').textContent =
    typeof obj === 'string' ? obj : JSON.stringify(obj, null, 2);
}

function logout() {
  localStorage.removeItem('admin_jwt');
  location.reload();
}

function authHeaders() {
  return token ? { Authorization: 'Bearer ' + token } : {};
}

async function loadUser() {
  const id = document.getElementById('userId').value;
  const res = await fetch(`${API}/admin/users/${id}`, {
    headers: authHeaders()
  });
  const json = await res.json();
  document.getElementById('userData').textContent =
    JSON.stringify(json, null, 2);
}

async function giveStars() {
  const id = document.getElementById('userId').value;
  const amount = Number(document.getElementById('starsAmount').value);
  const res = await fetch(`${API}/admin/users/${id}/actions`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      ...authHeaders()
    },
    body: JSON.stringify({ action:'give_stars', amount })
  });
  setDebug(await res.json());
  loadUser();
}

async function giveCash() {
  const id = document.getElementById('userId').value;
  const amount = Number(document.getElementById('cashAmount').value);
  const res = await fetch(`${API}/admin/users/${id}/actions`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      ...authHeaders()
    },
    body: JSON.stringify({ action:'give_cash', amount })
  });
  setDebug(await res.json());
  loadUser();
}

function onTelegramAuth(user) {
  fetch(`${API}/auth/telegram`, {
    method: 'GET',
    credentials: 'include'
  }).then(r => r.json()).then(data => {
    token = data.token;
    localStorage.setItem('admin_jwt', token);
    document.getElementById('loginStatus').textContent = 'Залогінено';
    document.getElementById('adminId').textContent = user.id;
  }).catch(err => {
    setDebug(err.toString());
  });
}
</script>

<script async src="https://telegram.org/js/telegram-widget.js?22"
  data-telegram-login="boxing_manager_game_bot"
  data-size="large"
  data-userpic="true"
  data-request-access="write"
  data-onauth="onTelegramAuth">
</script>

</body>
</html>
