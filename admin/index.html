<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <title>Admin panel</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <style>
    body { font-family: Arial; max-width: 900px; margin: 20px auto; }
    .card { border: 1px solid #ccc; padding: 16px; margin-bottom: 16px; border-radius: 8px; }
    .row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
    input, button, textarea { padding: 8px; }
    textarea { width: 100%; height: 180px; }
    pre { background: #f6f6f6; padding: 10px; }
    .danger { background: #c62828; color: #fff; }
  </style>
</head>

<body>

<h1>Admin panel</h1>
<div>API: https://boxing-manager-admin-api.onrender.com</div>

<!-- LOGIN -->
<div class="card">
  <script async
    src="https://telegram.org/js/telegram-widget.js?22"
    data-telegram-login="boxing_manager_game_bot"
    data-size="large"
    data-onauth="onTelegramAuth(user)">
  </script>
  <div id="loginStatus">Не залогінено</div>
</div>

<!-- ADMIN -->
<div class="card" id="adminCard" style="display:none;">
  Admin: <span id="adminInfo"></span>
  <button onclick="logout()">Logout</button>
</div>

<!-- USER -->
<div class="card" id="usersCard" style="display:none;">
  <h3>User</h3>
  <div class="row">
    <input id="userId" placeholder="telegram_user_id" />
    <button onclick="loadUser()">Load</button>
  </div>
  <pre id="userResult"></pre>

  <h4>Actions</h4>
  <div class="row">
    <input id="starsAmount" placeholder="Stars" />
    <button onclick="giveStars()">Give stars</button>
  </div>
  <div class="row">
    <input id="cashAmount" placeholder="Cash" />
    <button onclick="giveCash()">Give cash</button>
  </div>
</div>

<script>
const API = "https://boxing-manager-admin-api.onrender.com";
let token = localStorage.getItem("admin_token");

function authHeaders() {
  return token ? { "Authorization": "Bearer " + token } : {};
}

async function api(path, options = {}) {
  const res = await fetch(API + path, {
    ...options,
    headers: { "Content-Type": "application/json", ...authHeaders() }
  });
  return res.json();
}

window.onTelegramAuth = async (user) => {
  const res = await fetch(API + "/auth/telegram", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(user)
  });
  const data = await res.json();

  if (!res.ok) {
    document.getElementById("loginStatus").textContent = data.error;
    return;
  }

  token = data.token;
  localStorage.setItem("admin_token", token);

  document.getElementById("loginStatus").textContent = "Залогінено";
  document.getElementById("adminInfo").textContent = user.id;
  document.getElementById("adminCard").style.display = "";
  document.getElementById("usersCard").style.display = "";
};

function logout() {
  localStorage.removeItem("admin_token");
  location.reload();
}

async function loadUser() {
  const id = document.getElementById("userId").value;
  const data = await api("/admin/users/" + id);
  document.getElementById("userResult").textContent =
    JSON.stringify(data, null, 2);
}

async function giveStars() {
  const id = document.getElementById("userId").value;
  const amount = Number(document.getElementById("starsAmount").value);
  await api(`/admin/users/${id}/actions`, {
    method: "POST",
    body: JSON.stringify({ action: "give_stars", amount })
  });
  loadUser();
}

async function giveCash() {
  const id = document.getElementById("userId").value;
  const amount = Number(document.getElementById("cashAmount").value);
  await api(`/admin/users/${id}/actions`, {
    method: "POST",
    body: JSON.stringify({ action: "give_cash", amount })
  });
  loadUser();
}
</script>

</body>
</html>
