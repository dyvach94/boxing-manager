<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Boxing Manager</title>
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f1115;
      color: #fff;
    }
    header {
      display: flex;
      justify-content: space-between;
      padding: 12px 16px;
      background: #171a21;
      border-bottom: 1px solid #222;
    }
    .stat {
      font-weight: 600;
    }
    main {
      padding: 16px;
    }
    .muted {
      color: #888;
      font-size: 13px;
    }
  </style>
</head>
<body>

<header>
  <div class="stat">üíµ <span id="cash">0</span></div>
  <div class="stat">‚≠ê <span id="stars">0</span></div>
</header>

<main>
  <h2>Boxing Manager</h2>
  <div class="muted">–ë–∞–ª–∞–Ω—Å –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –∑ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –≤—Ö–æ–¥—ñ.</div>
</main>

<script>
/**
 * CONFIG
 */
const API = "https://boxing-manager-admin-api.onrender.com";

/**
 * STATE
 */
let telegramUserId = null;

/**
 * Telegram init
 */
function getTelegramUserId() {
  if (window.Telegram && Telegram.WebApp && Telegram.WebApp.initDataUnsafe) {
    return Telegram.WebApp.initDataUnsafe?.user?.id || null;
  }
  return null;
}

/**
 * UI
 */
function setBalance(cash, stars) {
  document.getElementById("cash").textContent = cash;
  document.getElementById("stars").textContent = stars;
}

/**
 * Load balance from server
 * ‚ùó READ ONLY
 */
async function loadBalance() {
  if (!telegramUserId) return;

  try {
    const res = await fetch(`${API}/public/users/${telegramUserId}?t=${Date.now()}`);
    if (!res.ok) return;

    const data = await res.json();

    // –ù–Ü–ö–û–õ–ò –Ω–µ –ø–∏—à–µ–º–æ –Ω–∞–∑–∞–¥
    setBalance(
      Number(data.cash ?? 0),
      Number(data.stars ?? 0)
    );

  } catch (e) {
    console.error("Failed to load balance", e);
  }
}

/**
 * BOOT
 */
document.addEventListener("DOMContentLoaded", () => {
  telegramUserId = getTelegramUserId();

  // fallback –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞
  if (!telegramUserId) {
    console.warn("Telegram ID not found, fallback disabled");
    return;
  }

  loadBalance();
});
</script>

</body>
</html>
